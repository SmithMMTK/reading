
DAX มีชุดฟังก์ชันที่ทรงพลังซึ่งช่วยให้คุณสามารถสร้างการคำนวณตั้งแต่พื้นฐานไปจนถึงขั้นซับซ้อนเพื่อตรวจวัดข้อมูลใน _semantic model_ ของคุณใน _Power BI_ ได้ โดยการใช้เงื่อนไขการกรอง, ตัวแปร, ฟังก์ชัน _iterator_, _window_ และ _information functions_ คุณสามารถสร้างสูตรที่มีประสิทธิภาพและอ่านง่ายยิ่งขึ้น

### Variables

ตัวแปรใน _DAX_ ช่วยให้คุณลดความซับซ้อนของสูตรและเพิ่มประสิทธิภาพโดยการเก็บค่าผลลัพธ์ของนิพจน์ไว้ในตัวแปรเพื่อใช้งานซ้ำหลายครั้ง ซึ่งจะลดการคำนวณซ้ำและทำให้โค้ดอ่านและดูแลรักษาได้ง่ายขึ้น

ลองดูตัวอย่างที่ต้องการคำนวณค่าเฉลี่ยยอดขายต่อหนึ่งลูกค้า โดยใช้ตัวแปรเก็บผลรวมยอดขายแล้วนำมาใช้ในสูตร:

```DAX
Average Sales per Customer = 
VAR Total Sales = SUM(Sales[Amount])
RETURN
    Total Sales / COUNTROWS(Sales)
````

แม้ว่าตัวอย่างนี้จะยังสามารถอ่านได้ง่ายโดยไม่ใช้ตัวแปร แต่สูตรที่ซับซ้อนสามารถใช้ตัวแปรหลายตัวเพื่อเพิ่มความชัดเจนให้กับโค้ดได้อย่างมาก

## **Iterators**

ฟังก์ชันแบบ _iterator_ ใน _DAX_ เช่น SUMX, AVERAGEX, และ MAXX จะทำการคำนวณทีละแถวในตารางแล้วส่งค่าผลลัพธ์เพียงหนึ่งค่า ฟังก์ชันเหล่านี้เหมาะสำหรับการคำนวณที่ต้องพิจารณาตามบริบทของแต่ละแถว


ตัวอย่างเช่น หากต้องการคำนวณกำไรรวมต่อผลิตภัณฑ์ สามารถใช้ SUMX ได้ดังนี้:

```
Total Profit = 
SUMX(
    Sales,
    Sales[Quantity] * (Sales[Price] - Sales[Cost])
)
```

ควรใช้อย่างระมัดระวังกับชุดข้อมูลขนาดใหญ่เนื่องจากการประมวลผลทีละแถวอาจกระทบต่อประสิทธิภาพ

## **Table Filtering**

ฟังก์ชันการกรองตาราง เช่น FILTER, ALL, และ CALCULATETABLE ช่วยให้คุณสามารถสร้างตารางที่กรองตามเงื่อนไขเฉพาะได้ ฟังก์ชันเหล่านี้เหมาะสำหรับการสร้างการคำนวณแบบไดนามิกที่ขึ้นอยู่กับบริบทของการกรอง

ตัวอย่างเช่น หากต้องการคำนวณยอดขายรวมสำหรับประเภทสินค้าหนึ่ง สามารถใช้ CALCULATETABLE ได้ดังนี้:

```
Total Sales for Category = 
CALCULATETABLE(
    SUMMARIZE(
        Sales,
        Sales[Amount]
    ),
    FILTER(
        Products,
        Products[Category] = "Electronics"
    )
)
```

ฟังก์ชัน CALCULATETABLE จะเปลี่ยนบริบทของการกรองให้เหลือเฉพาะแถวที่ Products[Category] เท่ากับ “Electronics” จากนั้น SUMMARIZE จะสรุปยอดขายในบริบทนี้ ส่งผลให้เมื่อใช้สูตรนี้ในภาพแสดงผลที่มีการแสดงยอดขายตามประเภทสินค้า ทุกแถวจะแสดงยอดขายรวมเฉพาะของ “Electronics” ไม่ว่าประเภทสินค้าในแถวจะเป็นอะไรก็ตาม

## **Windowing Functions**

ฟังก์ชันแบบ _window_ เช่น INDEX, OFFSET, และ WINDOW ช่วยให้คุณสามารถทำการคำนวณบนช่วงข้อมูลที่กำหนดได้ เหมาะสำหรับการจัดอันดับ, ยอดสะสม และการเปรียบเทียบที่ต้องอิงตามลำดับของข้อมูล

ตัวอย่างเช่น หากต้องการเปรียบเทียบยอดขายของสินค้าปัจจุบันกับสินค้าก่อนหน้า สามารถใช้ OFFSET ได้ดังนี้:

```
Previous Product Sales = 
CALCULATE(
    SUM(Sales[Amount]),
    OFFSET(-1, ORDERBY(Sales[Date], ASC))
)
```

ในตัวอย่างนี้ OFFSET จะเลื่อนบริบทไปยังแถวก่อนหน้าตามลำดับวันที่ใน Sales[Date] ทำให้สามารถเปรียบเทียบยอดขายของสินค้าปัจจุบันกับก่อนหน้าได้ เหมาะสำหรับการวิเคราะห์แนวโน้มและการเปรียบเทียบข้อมูล

## **Information Functions**

ฟังก์ชันแบบ _information_ เช่น ISBLANK, ISNUMBER, และ CONTAINS ใช้เพื่อตรวจสอบและคืนค่าข้อมูลเกี่ยวกับข้อมูลในโมเดล เหมาะสำหรับการสร้างสูตรแบบมีเงื่อนไขและจัดการกรณีพิเศษต่าง ๆ

ตัวอย่างเช่น หากต้องการคำนวณยอดขายรวมก็ต่อเมื่อมีการเลือกเพียงหนึ่งประเภทสินค้า สามารถใช้ HASONEVALUE ดังนี้:

```
Total Sales for Single Category = 
IF(
    HASONEVALUE(Products[Category]),
    SUM(Sales[Amount]),
    BLANK()
)
```

ฟังก์ชัน HASONEVALUE จะตรวจสอบว่าคอลัมน์ Products[Category] มีค่าที่ไม่ซ้ำกันเพียงค่าเดียวหรือไม่ ถ้ามีเพียงค่าหนึ่ง สูตรจะคำนวณยอดขายรวม ถ้ามีหลายค่า จะคืนค่า BLANK()

การใช้ _variables_ และ _functions_ ของ DAX จะช่วยให้คุณสามารถสร้างสูตรที่มีประสิทธิภาพ อ่านง่าย และยืดหยุ่นมากขึ้น ซึ่งช่วยเสริมพลังให้กับ _semantic model_ ของคุณใน Power BI ได้อย่างเต็มที่

_Tip_

อย่าลืมเพิ่มรายการโปรดให้กับ [Data Analysis Expressions (DAX) reference](https://learn.microsoft.com/en-us/dax/) เพื่อดูรายละเอียดเกี่ยวกับไวยากรณ์ ฟังก์ชัน และคำสั่งต่าง ๆ