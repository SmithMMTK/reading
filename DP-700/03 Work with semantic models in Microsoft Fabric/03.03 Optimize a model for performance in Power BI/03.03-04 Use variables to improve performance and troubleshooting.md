
คุณสามารถใช้ _variables_ ในสูตร _DAX_ เพื่อช่วยให้การคำนวณซับซ้อนน้อยลงและมีประสิทธิภาพมากขึ้น _Variables_ มักถูกมองข้ามโดยนักพัฒนาที่เพิ่งเริ่มต้นกับ Power BI Desktop ทั้งที่จริงแล้วเป็นเครื่องมือที่มีประสิทธิภาพและควรใช้งานให้ได้บ่อยที่สุดเท่าที่จะทำได้

บางสูตรมีการใช้ฟังก์ชันซ้อนกันหลายชั้นและใช้ตรรกะการคำนวณแบบเดิมซ้ำ ๆ ซึ่งทำให้ประมวลผลได้ช้าและอ่านยาก ส่งผลให้การ _troubleshoot_ เป็นเรื่องยาก การใช้ _variables_ จะช่วยลดเวลาในการประมวลผล _query_ และเป็นก้าวสำคัญในการเพิ่มประสิทธิภาพของ _semantic model_

ข้อดีของการใช้ _variables_ ใน _semantic model_ ได้แก่:

- **Improved performance** – _Variables_ ช่วยให้ _measures_ มีประสิทธิภาพมากขึ้น เพราะไม่ต้องประเมินนิพจน์เดิมซ้ำหลายครั้ง คุณสามารถได้ผลลัพธ์เท่าเดิมด้วยเวลาเพียงครึ่งเดียวของเดิม
- **Improved readability** – _Variables_ มักมีชื่อสั้นและอธิบายตัวเองได้ดี ใช้แทนนิพจน์ที่ยาวและเข้าใจยาก ทำให้สูตรอ่านและเข้าใจง่ายขึ้น
- **Simplified debugging** – คุณสามารถใช้ _variables_ เพื่อดีบักสูตรและทดสอบนิพจน์ ซึ่งมีประโยชน์มากในช่วงที่แก้ไขปัญหา
- **Reduced complexity** – _Variables_ ช่วยลดความจำเป็นในการใช้ฟังก์ชัน `EARLIER` หรือ `EARLIEST` ซึ่งเข้าใจยากและเคยจำเป็นในอดีตเมื่อต้องสร้าง _filter context_ ใหม่ ตอนนี้สามารถใช้ _variables_ แทนได้ ทำให้สูตรเขียนง่ายและซับซ้อนน้อยลง

## Use variables to improve performance

เพื่อแสดงให้เห็นว่าการใช้ _variable_ สามารถทำให้ _measure_ มีประสิทธิภาพมากขึ้นได้อย่างไร ตารางต่อไปนี้แสดงนิยามของ _measure_ แบบสองวิธี โดยสังเกตได้ว่าสูตรทั้งสองจะคำนวณ "ยอดขายช่วงเวลาเดียวกันของปีที่แล้ว" (_same period last year_) แต่ใช้วิธีต่างกัน:

ในตัวอย่างแรกเป็นการเขียนสูตรแบบปกติ ซึ่งมีการคำนวณนิพจน์เดียวกันซ้ำหลายครั้ง ขณะที่ในตัวอย่างที่สองมีการใช้ _variable_

แถวที่สองของตารางแสดงสูตรที่ปรับปรุงแล้ว โดยใช้คำสั่ง `VAR` เพื่อสร้าง _variable_ ชื่อ `SalesPriorYear` และกำหนดค่าผลลัพธ์ของนิพจน์ "same period last year" ให้กับตัวแปรนี้ แล้วนำตัวแปรไปใช้สองครั้งภายในฟังก์ชัน `DIVIDE`

**Without variable**

```excel
Sales YoY Growth =
DIVIDE(
    ([Sales] - CALCULATE([Sales], PARALLELPERIOD('Date'[Date], -12, MONTH))),
    CALCULATE([Sales], PARALLELPERIOD('Date'[Date], -12, MONTH))
)
```

**With variable**

```excel
Sales YoY Growth =
VAR SalesPriorYear =
    CALCULATE([Sales], PARALLELPERIOD('Date'[Date], -12, MONTH))
VAR SalesVariance =
    DIVIDE(([Sales] - SalesPriorYear), SalesPriorYear)
RETURN
    SalesVariance
```

ในนิยาม _measure_ แรก สูตรไม่มีประสิทธิภาพเพราะ Power BI ต้องประเมินนิพจน์เดิมสองครั้ง ส่วนสูตรที่สองมีประสิทธิภาพมากกว่า เพราะใช้ _variable_ ทำให้ Power BI ประเมินฟังก์ชัน `PARALLELPERIOD` เพียงครั้งเดียว

หาก _semantic model_ ของคุณมี _queries_ หลายตัวและมี _measures_ จำนวนมาก การใช้ _variables_ อาจช่วยลดเวลาในการประมวลผลโดยรวมลงครึ่งหนึ่ง และเพิ่มประสิทธิภาพของ _semantic model_ ได้อย่างมีนัยสำคัญ

นอกจากนี้ แนวทางนี้ยังง่ายต่อการนำไปใช้ ลองจินตนาการถึงผลที่ได้เมื่อคุณต้องเขียนสูตรที่ซับซ้อนมากขึ้น เช่น การคำนวณเปอร์เซ็นต์ หรือการทำ _running total_

## Use variables to improve readability

นอกจากประสิทธิภาพที่ดีขึ้นแล้ว คุณอาจสังเกตได้ว่าการใช้ _variables_ ยังช่วยให้โค้ดของคุณอ่านง่ายขึ้นอีกด้วย

แนวปฏิบัติที่ดีในการใช้ _variables_ คือการตั้งชื่อให้มีความหมายชัดเจน เช่นในตัวอย่างก่อนหน้าใช้ชื่อว่า `SalesPriorYear` ซึ่งสื่อได้ชัดเจนว่ากำลังคำนวณยอดขายของปีที่แล้ว ลองเปรียบเทียบกับการใช้ชื่อเช่น `X`, `temp` หรือ `variable1` ซึ่งไม่บอกเจตนาของตัวแปรเลย

การตั้งชื่อที่ชัดเจน กระชับ และสื่อความหมาย จะช่วยให้คุณเข้าใจและจัดทำเอกสารการคำนวณได้ง่ายขึ้น และยังช่วยให้นักพัฒนาคนอื่นสามารถดูแลรักษาโค้ดในอนาคตได้ง่ายขึ้นด้วย

## Use variables to troubleshoot multiple steps

คุณสามารถใช้ _variables_ เพื่อช่วยในการดีบักสูตรและระบุปัญหาที่เกิดขึ้นได้ _Variables_ ช่วยให้กระบวนการ _troubleshooting_ ง่ายขึ้น เพราะคุณสามารถประเมินค่าของแต่ละตัวแปรแยกกันได้ และเรียกใช้งานในคำสั่ง `RETURN`

ในตัวอย่างต่อไปนี้ คุณกำลังทดสอบนิพจน์ที่ถูกกำหนดไว้ในตัวแปร โดยในระหว่างการดีบัก คุณเขียนคำสั่ง `RETURN` ใหม่ชั่วคราวให้แสดงเฉพาะค่าของตัวแปร `SalesPriorYear` เท่านั้น ซึ่งเป็นค่าที่อยู่หลัง `RETURN`


```excel
Sales YoY Growth % =
VAR SalesPriorYear =  CALCULATE([Sales], PARALLELPERIOD('Date'[Date], -12, MONTH))
VAR SalesPriorYear% = DIVIDE(([Sales] - SalesPriorYear), SalesPriorYear)  
RETURN SalesPriorYear%
```

คำสั่ง `RETURN` จะคืนค่าเฉพาะตัวแปร `SalesPriorYear%` เท่านั้น เทคนิคนี้ช่วยให้คุณสามารถ _revert_ นิพจน์กลับได้เมื่อเสร็จสิ้นการดีบัก และยังทำให้สูตรคำนวณเข้าใจง่ายขึ้น เพราะลดความซับซ้อนของโค้ด _DAX_
