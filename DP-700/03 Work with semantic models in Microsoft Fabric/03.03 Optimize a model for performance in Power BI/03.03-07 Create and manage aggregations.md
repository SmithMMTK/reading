[![Diagram shows theory behind aggregating data.](https://learn.microsoft.com/en-us/training/modules/optimize-model-power-bi/media/6-aggregate-data-overview-ss.png)](https://learn.microsoft.com/en-us/training/modules/optimize-model-power-bi/media/6-aggregate-data-overview-ss.png#lightbox#lightbox)

องค์กรของคุณอาจเลือกใช้ _aggregations_ ใน _semantic model_ ด้วยเหตุผลต่อไปนี้:

- คุณทำงานกับข้อมูลขนาดใหญ่ ซึ่ง _aggregation_ จะช่วยปรับปรุงประสิทธิภาพของ _query_ และวิเคราะห์ข้อมูลได้ดีขึ้น ข้อมูลที่รวมแล้วจะถูก _cache_ ซึ่งใช้ทรัพยากรน้อยกว่าการเข้าถึงข้อมูลละเอียด
- คุณประสบปัญหาในการ _refresh_ ข้อมูลช้า _aggregation_ จะช่วยลดขนาดของ _cache_ ทำให้เวลาในการ _refresh_ สั้นลง ผู้ใช้จะเห็นข้อมูลเร็วขึ้น เพราะ _refresh_ ข้อมูลน้อยลง
- คุณมี _semantic model_ ขนาดใหญ่ _aggregation_ จะช่วยลดขนาดและควบคุมไม่ให้ _model_ โตเกินไป
- คุณคาดการณ์ว่า _semantic model_ จะเติบโตในอนาคต _aggregation_ จะช่วยเตรียมรับมือปัญหาที่จะเกิดจากประสิทธิภาพหรือการ _refresh_

ในสถานการณ์ของ _Tailwind Traders_ แม้ว่าคุณได้ปรับปรุงประสิทธิภาพของ _semantic model_ ไปหลายจุดแล้ว แต่ทีม IT แจ้งว่าขนาดไฟล์ยังใหญ่เกินไป (1 GB) และคุณต้องการลดขนาดให้เหลือประมาณ 50 MB โดยในระหว่างการตรวจสอบ คุณพบว่า _developer_ ก่อนหน้าไม่ได้ใช้ _aggregation_ กับข้อมูลขาย คุณจึงต้องสร้าง _aggregation_ เพื่อช่วยลดขนาดไฟล์และเพิ่มประสิทธิภาพ

## Create aggregations

ก่อนสร้าง _aggregation_ คุณควรกำหนดระดับความละเอียด (_granularity_) ที่ต้องการ ในตัวอย่างนี้คุณจะรวมข้อมูลขายระดับวัน (_day level_)

เมื่อกำหนด _grain_ ได้แล้ว ขั้นตอนถัดไปคือเลือกวิธีการสร้าง _aggregation_ ซึ่งสามารถทำได้หลายวิธี เช่น:

- หากคุณเข้าถึงฐานข้อมูลได้ คุณสามารถสร้าง _table_ หรือ _view_ แล้วนำเข้า _Power BI Desktop_
- ใช้ _Power Query_ ใน _Power BI Desktop_ เพื่อสร้าง _aggregation_ ทีละขั้นตอน

ในตัวอย่างนี้ คุณเปิด _query_ ใน _Power Query_ และพบว่าข้อมูลยังไม่ได้ถูกรวม มีมากกว่า 999 แถวตามภาพด้านล่าง

[![Screenshot displays total number of rows before aggregation.](https://learn.microsoft.com/en-us/training/modules/optimize-model-power-bi/media/6-aggregate-data-before-ssm.png)](https://learn.microsoft.com/en-us/training/modules/optimize-model-power-bi/media/6-aggregate-data-before-ssm.png#lightbox#lightbox)

คุณต้องการ _group by_ คอลัมน์ `OrderDate` และสรุป `OrderQuantity` กับ `SalesAmount` เริ่มต้นด้วยการเลือก **Choose Columns** ที่แถบ **Home** จากนั้นเลือกคอลัมน์ที่จะใช้ในการรวม แล้วคลิก **OK**

[![Screenshot shows how to choose columns when aggregating data.](https://learn.microsoft.com/en-us/training/modules/optimize-model-power-bi/media/6-aggregate-choose-columns-ssm.png)](https://learn.microsoft.com/en-us/training/modules/optimize-model-power-bi/media/6-aggregate-choose-columns-ssm.png#lightbox#lightbox)

เมื่อแสดงคอลัมน์บนหน้าจอแล้ว ให้เลือก **Group By** ที่แถบ **Home** จากนั้นในหน้าต่างที่เปิดขึ้น ให้เลือกคอลัมน์ `OrderDate` เพื่อใช้ _group by_ และตั้งชื่อคอลัมน์ใหม่ว่า `OnlineOrdersCount`

เลือก **Advanced** แล้วคลิก **Add aggregation** เพื่อเพิ่มแถวสำหรับกำหนด _aggregation_ อื่น ตั้งชื่อคอลัมน์ เลือก _operation_ ที่ต้องการใช้ แล้วเลือกคอลัมน์ที่จะนำไปใช้ ทำซ้ำจนใส่ _aggregation_ ครบ แล้วคลิก **OK**

[![Screenshot shows how to use the Group by button.](https://learn.microsoft.com/en-us/training/modules/optimize-model-power-bi/media/6-aggregate-group-ssm.png)](https://learn.microsoft.com/en-us/training/modules/optimize-model-power-bi/media/6-aggregate-group-ssm.png#lightbox#lightbox)

อาจใช้เวลาสักครู่ก่อนที่ผลลัพธ์ของ _aggregation_ จะแสดง แต่เมื่อแสดงแล้วคุณจะเห็นข้อมูลที่ถูกรวมตามวันที่ และมีค่ารวมของจำนวนคำสั่งซื้อและยอดขายตามแต่ละวัน

[![Screenshot of the resulting table after aggregation.](https://learn.microsoft.com/en-us/training/modules/optimize-model-power-bi/media/6-aggregate-data-after-new-columns-ss.png)](https://learn.microsoft.com/en-us/training/modules/optimize-model-power-bi/media/6-aggregate-data-after-new-columns-ss.png#lightbox#lightbox)

คลิก **Close and Apply** เพื่อปิด _Power Query Editor_ และนำการเปลี่ยนแปลงไปใช้ใน _semantic model_ จากนั้นที่ _Power BI Desktop_ แถบ **Home** คลิก **Refresh** เพื่อโหลดข้อมูลใหม่ คุณจะเห็นข้อความระบุจำนวนแถวที่ถูกโหลด ซึ่งควรน้อยลงอย่างมากจากเดิม

คุณสามารถเห็นจำนวนแถวใหม่ได้อีกครั้งเมื่อเปิด _Power Query Editor_ ตามภาพด้านล่าง แสดงให้เห็นว่าจากเดิม 999+ แถว เหลือเพียง 30 แถว

[![Screenshot of the total rows and columns after aggregation.](https://learn.microsoft.com/en-us/training/modules/optimize-model-power-bi/media/6-aggregate-data-after-less-rows-ssm.png)](https://learn.microsoft.com/en-us/training/modules/optimize-model-power-bi/media/6-aggregate-data-after-less-rows-ssm.png#lightbox#lightbox)

การใช้ _aggregation_ ได้ช่วยลดจำนวนแถวใน _semantic model_ อย่างมาก ทำให้ Power BI ต้องโหลดข้อมูลน้อยลง ส่งผลให้ประสิทธิภาพดีขึ้น

## Manage aggregations

คุณสามารถจัดการ _aggregation_ ได้ภายหลังใน _Power BI Desktop_ หากต้องการเปลี่ยนแปลงพฤติกรรม

ไปที่ **Data** pane คลิกขวาที่ตาราง แล้วเลือก **Manage aggregations**

[![Screenshot shows the manage aggregations window.](https://learn.microsoft.com/en-us/training/modules/optimize-model-power-bi/media/6-open-manage-aggregations-window-ssm.png)](https://learn.microsoft.com/en-us/training/modules/optimize-model-power-bi/media/6-open-manage-aggregations-window-ssm.png#lightbox#lightbox)

สำหรับแต่ละคอลัมน์ที่ใช้ในการ _aggregate_ คุณสามารถเลือกการสรุปจาก **Summarization** และกำหนดรายละเอียดของตารางและคอลัมน์ต้นทาง เมื่อจัดการเสร็จแล้วให้คลิก **Apply All**