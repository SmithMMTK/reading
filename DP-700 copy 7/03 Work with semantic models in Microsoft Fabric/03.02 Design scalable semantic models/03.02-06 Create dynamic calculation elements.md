
เวลาทำรายงานใน Power BI ถ้าเราคำนวณหรือสร้างภาพไว้แบบตายตัวเยอะ ๆ รายงานจะเริ่มช้า แก้ไขยาก และดูรก

เราสามารถทำให้รายงานยืดหยุ่นและเร็วขึ้นได้โดยใช้ 3 อย่างนี้:

- **calculation groups**: รวมสูตรที่ใช้บ่อย เช่น YTD, QTD, MTD ไว้ที่เดียว ไม่ต้องสร้างหลายสูตร
- **field parameters**: ให้คนดูรายงานเลือกเองว่าจะดูข้อมูลตามอะไร เช่น สินค้า หรือหมวดหมู่ ในภาพเดียวกัน
- **dynamic format strings**: แสดงตัวเลขให้ดูง่าย เช่น ถ้ายอดขายเยอะ แสดงเป็น "ล้าน", ถ้าน้อย แสดงเต็มจำนวน

สรุปคือ ทั้ง 3 อย่างนี้ช่วยให้รายงาน:

- โหลดเร็วขึ้น
- ไม่ต้องทำซ้ำเยอะ
- ปรับเปลี่ยนได้ตามที่ผู้ใช้ต้องการ
- จัดการง่ายเวลารายงานใหญ่

จำไว้ว่าถ้าเจอคำว่า **flexible report** หรือ **scalable model** ให้คิดถึง 3 ตัวนี้ไว้เลย

## Calculation groups

_calculation groups_ คือวิธีรวมสูตรคำนวณที่ใช้ซ้ำบ่อย ๆ ไว้ในที่เดียว เช่น สูตรพวก YTD, QTD, MTD แทนที่จะต้องสร้างสูตรแยกหลายอันสำหรับแต่ละ _measure_ เช่น ยอดขาย กำไร หรือเป้ายอด

การใช้ _calculation group_ ช่วยให้:

- ลดความซ้ำซ้อนของสูตร
- ดูแลสูตรได้ง่ายขึ้น
- ทำให้โมเดลสะอาดและจัดการง่าย

เช่น ถ้าคุณต้องการคำนวณยอดขายแบบ:

- _YTD_ = ยอดขายสะสมตั้งแต่ต้นปี
- _QTD_ = ยอดขายสะสมตั้งแต่ต้นไตรมาส
- _MTD_ = ยอดขายสะสมตั้งแต่ต้นเดือน

คุณไม่ต้องสร้าง 3 สูตรแยกสำหรับ `Total Sales`, `Profit`, `Target` ฯลฯ  
แค่สร้าง _calculation group_ ชื่อว่า **Time Intelligence** แล้วใส่รายการสูตรพวกนี้ไว้ จากนั้นเอาไปใช้กับ _measure_ ไหนก็ได้ทันที

แบบนี้จะทำให้การคำนวณในรายงานยืดหยุ่นและดูแลง่ายมากขึ้น

```DAX
Year-to-Date (YTD) = 
CALCULATE(
    SELECTEDMEASURE(),
    DATESYTD('Date'[Date])
)
//
Quarter-to-Date (QTD) = 
CALCULATE(
    SELECTEDMEASURE(),
    DATESQTD('Date'[Date])
)
//
Month-to-Date (MTD) = 
CALCULATE(
    SELECTEDMEASURE(),
    DATESMTD('Date'[Date])
)
````

คุณสามารถใช้ _calculation group_ นี้ได้ใน _filter pane_, _slicer_, _visual_ หรือแม้กระทั่งใน _measure_ อื่นๆ โดยที่รายการ YTD, QTD, MTD จะปรากฏขึ้นโดยอัตโนมัติเพื่อใช้กรองหรือขยายผลในภาพแสดงผล
  
ในภาพด้านล่าง เราใช้ _matrix visual_ แสดงยอดขายรวมในแต่ละปีการเงินตามช่วงเวลา YTD, QTD, MTD พร้อม _slicer_ สำหรับให้ผู้ใช้เลือกช่วงเวลา
- Rows: **Date[Year]**
- Columns: **Time Calc** (calculation group)
- Values: **Total Sales**

![Screenshot of the matrix visual showing the Total Sales for YTD, QTD, and MTD for each year.](https://learn.microsoft.com/en-us/training/wwl/design-scalable-semantic-models/media/calculation-group-matrix.png)

หากไม่มี _calculation group_ คุณต้องสร้าง _YTD_, _QTD_, _MTD_ แยกสำหรับแต่ละ _measure_ ที่ต้องใช้ เช่น _Total Sales_, _Profit_, _Target_ เป็นต้น แต่ด้วย _calculation group_ คุณสามารถใช้เพียงกลุ่มเดียวและนำไปประยุกต์ใช้กับ _measure_ อื่นได้ทันที

คุณสมบัติที่ยืดหยุ่นและนำกลับมาใช้ซ้ำได้ของ _calculation groups_ ทำให้มันเป็นเครื่องมือสำคัญสำหรับการปรับขยาย _semantic model_ ของคุณ

_Tip_

ดูวิธีการใช้งานได้ที่ [Create calculations groups in Power BI](https://learn.microsoft.com/en-us/power-bi/transform-model/calculation-groups)

## **Field parameters**

_field parameters_ ช่วยให้คุณสร้างรายงานแบบโต้ตอบได้ (_interactive_) โดยให้ผู้ใช้เลือก _field_ หรือ _measure_ ที่ต้องการดูได้แบบไดนามิก ฟีเจอร์นี้เหมาะสำหรับรายงานที่ต้องการให้ผู้ใช้สามารถเลือกข้อมูลได้เอง

ในตัวอย่างนี้ เราสร้าง _parameter_ ใหม่เพื่อรวม _Product_, _Category_, และ _Color_ จากนั้นนำ _parameter_ นี้ไปใช้ในแกน X ของภาพแสดงผลแทนการใส่ _field_ ทีละตัว และเพิ่ม _slicer_ เพื่อให้ผู้ใช้เลือกว่าจะดูยอดขายตาม _Product_, _Category_ หรือ _Color_

![Screenshot of the Total Sales by Product column chart and slicer.](https://learn.microsoft.com/en-us/training/wwl/design-scalable-semantic-models/media/column-chart-parameter-slicer.png)

ก่อนจะมี _field parameters_ นักพัฒนารายงานอาจต้องสร้างภาพแยกสำหรับแต่ละ _field_ แล้วใช้การซ้อนภาพพร้อม _bookmark_ และ _button_ เพื่อให้ผู้ใช้สลับไปมา แต่การมีหลายภาพในหน้าเดียวอาจส่งผลต่อประสิทธิภาพของรายงาน

_Tip_ ดูวิธีการใช้งานได้ที่ [Let report readers use field parameters to change visuals](https://learn.microsoft.com/en-us/power-bi/create-reports/power-bi-field-parameters)

## **Dynamic format strings**

_dynamic format strings_ ช่วยให้คุณสามารถปรับรูปแบบของ _measure_ ตามเงื่อนไขที่กำหนด ซึ่งจะช่วยเพิ่มความชัดเจนและเหมาะสมในการนำเสนอข้อมูล

สมมติว่าคุณต้องการแสดงยอดขายตามระดับมูลค่า:
- แสดงเป็น “ล้าน” (_M_) หากยอดขายเกิน 1,000,000
- แสดงเป็น “พัน” (_K_) หากยอดขายอยู่ระหว่าง 1,000 ถึง 1,000,000
- แสดงค่าตรงๆ หากยอดขายต่ำกว่า 1,000

ตัวอย่างโค้ดใช้ SWITCH เพื่อปรับรูปแบบดังนี้:

```
Total Sales with Format = 
SWITCH(
    TRUE(),
    [Total Sales] > 1000000, FORMAT([Total Sales], "$#,##0,,M"),
    [Total Sales] > 1000, FORMAT([Total Sales], "$#,##0,K"),
    FORMAT([Total Sales], "$#,##0")
)
```

_dynamic format strings_ ช่วยให้คุณลดความจำเป็นในการสร้าง _measure_ หรือภาพแยกย่อย และสามารถใช้ร่วมกับ _calculation groups_ เพื่อเพิ่มประสิทธิภาพและลดภาระในการดูแลรักษาโค้ด

_Tip_

ดูวิธีการใช้งานได้ที่ [Create dynamic format strings for measures](https://learn.microsoft.com/en-us/power-bi/create-reports/desktop-dynamic-format-strings)