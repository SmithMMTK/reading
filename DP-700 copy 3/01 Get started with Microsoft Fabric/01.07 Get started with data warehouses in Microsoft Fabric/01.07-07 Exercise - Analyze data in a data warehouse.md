
[Launch Exercise](https://go.microsoft.com/fwlink/?linkid=2259608)

## Create tables and insert data

```sql
CREATE TABLE dbo.DimProduct
(
    ProductKey INTEGER NOT NULL,
    ProductAltKey VARCHAR(25) NULL,
    ProductName VARCHAR(50) NOT NULL,
    Category VARCHAR(50) NULL,
    ListPrice DECIMAL(5,2) NULL
);
GO
```

```output
my_warehouse
└── Schemas
    └── dbo
        └── Tables
            └── DimProduct
                ├── 123 ProductKey
                ├── ABC ProductAltKey
                ├── ABC ProductName
                ├── ABC Category
                └── eˣ  ListPrice
        ├── Views
        ├── Functions
        └── Stored Procedures
```

```sql
INSERT INTO dbo.DimProduct
VALUES
(1, 'RING1', 'Bicycle bell', 'Accessories', 5.99),
(2, 'BRITE1', 'Front light', 'Accessories', 15.49),
(3, 'BRITE2', 'Rear light', 'Accessories', 15.49);
GO
```

[Create DW](https://raw.githubusercontent.com/MicrosoftLearning/dp-data/main/create-dw.txt)

```t-sql
IF EXISTS (
    SELECT * FROM sys.sysobjects
    WHERE name = 'DimProduct')
DROP TABLE dbo.DimProduct;
GO

CREATE TABLE dbo.DimProduct
(
    ProductKey INTEGER NOT NULL,
    ProductAltKey VARCHAR(25) NULL,
    ProductName VARCHAR(50) NOT NULL,
    Category VARCHAR(50) NULL,
    ListPrice DECIMAL NULL
);
GO

INSERT INTO dbo.DimProduct
VALUES
(1, 'RING1', 'Bicycle bell', 'Accssories', 5.99),
(2, 'BRITE1', 'Front light', 'Accessories', 15.49),
(3, 'BRITE2', 'Rear light', 'Accessories', 15.49),
...
```

```output
Schemas
└── dbo
    └── Tables
        ├── DimCustomer
        ├── DimDate
        ├── DimProduct
        └── FactSalesOrder
    ├── Views
    ├── Functions
    └── Stored Procedures
```

```output
+----------------+        +---------------+        +----------------+
|  DimCustomer   |        |   DimDate     |        |   DimProduct   |
|----------------|        |---------------|        |----------------|
| AddressLine1   |        | DateAltKey    |        | Category       |
| City           |        | DateKey       |        | ListPrice      |
| CountryRegion  |        | DayOfMonth    |        | ProductAltKey  |
| CustomerAltKey |        | DayOfWeek     |        | ProductKey     |
| CustomerKey    |        | Month         |        | ProductName    |
| FirstName      |        | MonthName     |        
| LastName       |        | WeekDayName   |        
| PostalCode     |        | Year          |        
| StateProvince  |                                    
+----------------+        +---------------+        +----------------+

          +---------------------+
          |   FactSalesOrder    |
          |---------------------|
          | CustomerKey         |
          | ProductKey          |
          | Quantity            |
          | SalesOrderDateKey   |
          | SalesOrderKey       |
          | SalesTotal          |
          +---------------------+
```

**Note**: The views **frequently_run_queries**, **long_running_queries**, **exec_sessions_history**, and **exec_requests_history** are part of the **queryinsights** schema automatically created by Fabric. It is a feature that provides a holistic view of historical query activity on the SQL analytics endpoint. Since this feature is out of the scope of this exercise, those views should be ignored for now.

## Define a data model

```output
      +----------------+       +----------------+       +----------------+
      |  DimCustomer   |       |    DimDate     |       |   DimProduct   |
      |----------------|       |----------------|       |----------------|
      |  CustomerKey   |       |   DateKey      |       |   ProductKey   |
      |      ...       |       |     ...        |       |      ...       |
      +--------+-------+       +--------+-------+       +--------+-------+
               |                        |                        |
               |                        |                        |
               v                        v                        v
+--------------------------------------------------------------------------+
|                              FactSalesOrder                              |
|--------------------------------------------------------------------------|
| CustomerKey | ProductKey | SalesOrderDateKey | Quantity | SalesTotal     |
+--------------------------------------------------------------------------+
```

## Query data warehouse tables

### Query fact and dimension tables

```sql
SELECT  d.[Year] AS CalendarYear,
         d.[Month] AS MonthOfYear,
         d.MonthName AS MonthName,
        SUM(so.SalesTotal) AS SalesRevenue
FROM FactSalesOrder AS so
JOIN DimDate AS d ON so.SalesOrderDateKey = d.DateKey
GROUP BY d.[Year], d.[Month], d.MonthName
ORDER BY CalendarYear, MonthOfYear;
```

```sql
SELECT  d.[Year] AS CalendarYear,
        d.[Month] AS MonthOfYear,
        d.MonthName AS MonthName,
        c.CountryRegion AS SalesRegion,
       SUM(so.SalesTotal) AS SalesRevenue
FROM FactSalesOrder AS so
JOIN DimDate AS d ON so.SalesOrderDateKey = d.DateKey
JOIN DimCustomer AS c ON so.CustomerKey = c.CustomerKey
GROUP BY d.[Year], d.[Month], d.MonthName, c.CountryRegion
ORDER BY CalendarYear, MonthOfYear, SalesRegion;
```

## Create a view

```sql
CREATE VIEW vSalesByRegion
AS
SELECT  d.[Year] AS CalendarYear,
        d.[Month] AS MonthOfYear,
        d.MonthName AS MonthName,
        c.CountryRegion AS SalesRegion,
       SUM(so.SalesTotal) AS SalesRevenue
FROM FactSalesOrder AS so
JOIN DimDate AS d ON so.SalesOrderDateKey = d.DateKey
JOIN DimCustomer AS c ON so.CustomerKey = c.CustomerKey
GROUP BY d.[Year], d.[Month], d.MonthName, c.CountryRegion;
```

```output
my_warehouse
└── Schemas
    └── dbo
        ├── Tables
        │   ├── DimCustomer
        │   ├── DimDate
        │   ├── DimProduct
        │   └── FactSalesOrder
        └── Views
            └── vSalesByRegion
```

## Create a visual query

```output
+------------------------------+
|   ▾ [SQL] New Query          |
+------------------------------+
| ► New SQL query              |
| +--------------------------+ |
| | ► New visual query       | |
| +--------------------------+ |
| ► New SQL query in notebook  |
+------------------------------+
```

