
#### Regression Models

*Regression models* ถูกฝึกมาเพื่อทำนายค่าตัวเลข (numeric label) โดยอิงจากข้อมูล training ที่มีทั้ง features และ label ที่รู้ค่าล่วงหน้า

กระบวนการฝึกโมเดล regression (หรือโมเดล *supervised learning* ใด ๆ) จะทำแบบวนซ้ำหลายรอบ  
ในแต่ละรอบจะใช้อัลกอริทึมที่เหมาะสม (พร้อมพารามิเตอร์ที่ตั้งค่าไว้) เพื่อฝึกโมเดล  
จากนั้นประเมินประสิทธิภาพในการทำนาย แล้วปรับแต่งโมเดลโดยเปลี่ยนอัลกอริทึมหรือพารามิเตอร์  
ทำซ้ำจนกว่าจะได้ผลลัพธ์ที่แม่นยำในระดับที่ยอมรับได้

![Diagram showing the process of training an evaluating a supervised model.](https://learn.microsoft.com/en-us/training/wwl-data-ai/fundamentals-machine-learning/media/supervised-training.png)


ภาพประกอบแสดง 4 ขั้นตอนหลักของการฝึกโมเดล machine learning แบบ *supervised* ดังนี้:

1. แบ่งข้อมูล training แบบสุ่ม เพื่อสร้างชุดข้อมูลที่ใช้ฝึกโมเดล พร้อมกับกันบางส่วนไว้สำหรับ *validation*
2. ใช้อัลกอริทึมในการฝึกโมเดลจากข้อมูลที่เตรียมไว้  
   (ถ้าเป็น regression model ก็ใช้อัลกอริทึมอย่าง *linear regression*)
3. ใช้ข้อมูล validation (__validation data__) ที่กันไว้ เพื่อทดสอบโมเดล โดยให้โมเดลทำนายค่าป้ายกำกับ (label) จาก features
4. เปรียบเทียบค่า *actual* จาก validation dataset กับค่าที่โมเดล *predicted*  
   จากนั้นวัดความแตกต่างรวมทั้งหมดระหว่างค่าจริงกับค่าทำนาย  
   เพื่อนำมาคำนวณเป็นเมตริกที่ใช้ประเมินว่าโมเดลทำนายได้แม่นยำเพียงใด 

| **Temperature (x)** | **Ice cream sales (y)** |
| ------------------- | ----------------------- |
| 51                  | 1                       |
| 52                  | 0                       |
| 67                  | 14                      |
| 65                  | 14                      |
| 70                  | 23                      |
| 69                  | 20                      |
| 72                  | 23                      |
| 75                  | 26                      |
| 73                  | 22                      |
| 81                  | 30                      |
| 78                  | 26                      |
| 83                  | 36                      |

| Temperature (x) | Ice cream sales (y) |
| --------------- | ------------------- |
| 52              | 0                   |
| 67              | 14                  |
| 70              | 23                  |
| 73              | 22                  |
| 78              | 26                  |
| 83              | 36                  |

| Temperature (x) | Actual sales (y) | Predicted sales (ŷ) |
| --------------- | ---------------- | ------------------- |
| 52              | 0                | 2                   |
| 67              | 14               | 17                  |
| 70              | 23               | 20                  |
| 73              | 22               | 23                  |
| 78              | 26               | 28                  |
| 83              | 36               | 33                  |


หลังจากจบแต่ละรอบ **train → validate → evaluate** สามารถทำซ้ำขั้นตอนเดิมได้ โดยลองใช้อัลกอริทึมและพารามิเตอร์ที่แตกต่างกันไปเรื่อย ๆ จนกว่าจะได้ค่าเมตริกประเมินที่น่าพอใจ

![Diagram of a scatter plot showing predicted and actual values.](https://learn.microsoft.com/en-us/training/wwl-data-ai/fundamentals-machine-learning/media/regression-variance.png)


ค่าทำนาย (_**ŷ**_) ถูกคำนวณโดยโมเดลตามเส้นของฟังก์ชันที่ฝึกไว้  แต่จะมีความคลาดเคลื่อนบางส่วนระหว่างค่า _**ŷ**_ และค่า _**y**_ จริงจาก validation dataset

ในกราฟจะแสดงเส้นเชื่อมระหว่าง _**ŷ**_ และ _**y**_ เพื่อแสดงว่าค่าทำนายคลาดเคลื่อนจากค่าจริงมากแค่ไหน

### Regression evaluation metrics

จากความแตกต่างระหว่างค่าทำนาย (_**ŷ**_) และค่าจริง (_**y**_)  
เราสามารถคำนวณเมตริกมาตรฐานต่าง ๆ ที่ใช้ประเมินประสิทธิภาพของโมเดล *regression* ได้

#### Mean Absolute Error (MAE)

*MAE* วัดค่าความผิดพลาดโดยเฉลี่ยของแต่ละการทำนาย โดยไม่สนใจว่าค่าทำนายจะสูงหรือต่ำกว่าค่าจริง  
เช่น ค่าความคลาดเคลื่อน -3 และ +3 ถือว่ามีความคลาดเคลื่อนเท่ากันคือ 3

ค่าเฉลี่ยของ absolute errors ในตัวอย่างไอศกรีม (2, 3, 3, 1, 2, 3) คือ **2.33**

#### Mean Squared Error (MSE)

*MAE* ให้น้ำหนักความผิดพลาดทุกกรณีเท่ากัน แต่ในหลายกรณีเราอาจต้องการ penalize การทำนายที่ผิดพลาดมาก  
*MSE* แก้ปัญหานี้โดยการ **ยกกำลังสอง** ความคลาดเคลื่อนแต่ละค่าแล้วหารเฉลี่ย

ในตัวอย่างไอศกรีม ค่า squared errors คือ 4, 9, 9, 1, 4, 9  
ค่าเฉลี่ยคือ **6**

#### Root Mean Squared Error (RMSE)

*MSE* ช่วยเน้นความผิดพลาดขนาดใหญ่ แต่ค่าที่ได้ไม่สื่อถึงหน่วยจริงของ label (จำนวนไอศกรีม)  
หากต้องการแสดงค่าความผิดพลาดในหน่วยจริง เราต้องถอดรากจาก MSE

*RMSE* คือ √6 = **2.45** (ไอศกรีม)

#### Coefficient of Determination (R²)

เมตริกทั้งหมดข้างต้นวัดความคลาดเคลื่อนระหว่างค่าทำนายกับค่าจริง  
แต่ในความเป็นจริง การขายไอศกรีมต่อวันมีความแปรปรวนโดยธรรมชาติ  
โมเดล regression พยายามหาค่าฟังก์ชันที่ลดความคลาดเคลื่อนนี้ให้ได้มากที่สุด

*R²* หรือ *R-Squared* คือเมตริกที่บอกว่าโมเดลสามารถอธิบายความแปรปรวนในข้อมูล validation ได้มากน้อยแค่ไหน  
เช่น ถ้ามีเทศกาลพิเศษที่ทำให้ยอดขายพุ่งผิดปกติ R² จะช่วยวัดว่าโมเดลเข้าใจแนวโน้มโดยรวมได้ดีหรือไม่

การคำนวณ R² เปรียบเทียบความคลาดเคลื่อนระหว่างค่าทำนายและค่าจริง  
กับความคลาดเคลื่อนระหว่างค่าจริงแต่ละจุดกับค่าเฉลี่ยของ label


$$
R^2 = 1 - \frac{\sum(y - \hat{y})^2}{\sum(y - \bar{y})^2}
$$

อย่ากังวลหากสูตรของ *R²* ดูซับซ้อนเกินไป เพราะเครื่องมือ machine learning ส่วนใหญ่สามารถคำนวณให้อัตโนมัติ

สิ่งสำคัญคือ *R²* จะให้ค่าระหว่าง 0 ถึง 1 เพื่อบอกว่าโมเดลสามารถอธิบายความแปรปรวนในข้อมูลได้มากแค่ไหน

พูดง่าย ๆ คือ ยิ่งค่า *R²* ใกล้ 1 มากเท่าไหร่ โมเดลก็ยิ่ง fit กับข้อมูล validation ได้ดี  
ในตัวอย่างโมเดลไอศกรีม ค่า *R²* ที่ได้คือ **0.95**

## Iterative training

เมตริกที่อธิบายไปข้างต้นเป็นเมตริกมาตรฐานที่ใช้ประเมินโมเดล *regression*  

ในโลกความเป็นจริง นักวิทยาศาสตร์ข้อมูลมักใช้กระบวนการแบบวนซ้ำ (iterative) เพื่อฝึกและประเมินโมเดลซ้ำ ๆ  
โดยปรับเปลี่ยนสิ่งต่อไปนี้ในแต่ละรอบ:

- การเลือกและเตรียม *features* (เลือกว่าจะใช้ feature ใด และประมวลผลหรือแปลงข้อมูลอย่างไรเพื่อช่วยให้โมเดล fit ได้ดีขึ้น)
- การเลือกอัลกอริทึม (ตัวอย่างที่กล่าวถึงคือ *linear regression* แต่ยังมีอัลกอริทึม regression อื่น ๆ อีกมาก)
- การตั้งค่าอัลกอริทึม (*hyperparameters* ซึ่งเป็นค่าตัวเลขที่ควบคุมพฤติกรรมของอัลกอริทึม โดยต่างจาก _**x**_ และ _**y**_ ที่เป็นพารามิเตอร์ของข้อมูล)

หลังจากวนซ้ำหลายครั้ง จะเลือกโมเดลที่ให้เมตริกประเมินดีที่สุด และตรงตามเกณฑ์ที่ยอมรับได้ในบริบทนั้น ๆ