คุณควรวางแผนว่าจะ _ผสานรวม (integrate)_ โมเดลอย่างไร เพราะสิ่งนี้จะส่งผลต่อวิธีที่คุณ _ฝึกโมเดล_ และข้อมูลที่คุณใช้ในการฝึก การผสานรวมโมเดล หมายถึงการ _นำโมเดลไปใช้งาน (deploy)_ โดยการส่งโมเดลไปยัง _endpoint_ ซึ่งเป็นจุดเชื่อมต่อสำหรับเรียกใช้งานโมเดล คุณสามารถ _deploy_ โมเดลไปยัง endpoint ได้ทั้งแบบ _การพยากรณ์แบบเรียลไทม์ (real-time prediction)_ หรือ _การพยากรณ์แบบเป็นชุด (batch prediction)_

## Deploy a model to an endpoint

เมื่อคุณ _ฝึกโมเดล_ เป้าหมายหลักมักจะเป็นการ _ผสานโมเดลเข้าในแอปพลิเคชัน_

เพื่อให้ผสานรวมได้ง่าย คุณสามารถใช้ _endpoint_ ซึ่งก็คือ _ที่อยู่เว็บ (web address)_ ที่แอปพลิเคชันสามารถเรียกใช้งานเพื่อรับผลลัพธ์กลับมา

เมื่อคุณ _deploy_ โมเดลไปยัง _endpoint_ จะมีตัวเลือก 2 แบบคือ

- รับผลลัพธ์แบบ _เรียลไทม์ (real-time prediction)_
- รับผลลัพธ์แบบ _เป็นชุด (batch prediction)_
### Get real-time predictions

ถ้าคุณต้องการให้โมเดลประมวลผลข้อมูลใหม่ทันทีที่เข้ามา คุณจะต้องใช้ _การพยากรณ์แบบเรียลไทม์ (real-time prediction)_

การพยากรณ์แบบ _เรียลไทม์_ มักจำเป็นเมื่อโมเดลถูกใช้ใน _แอปพลิเคชัน_ เช่น _แอปมือถือ_ หรือ _เว็บไซต์_

ลองจินตนาการว่าคุณมีเว็บไซต์ที่แสดง _แค็ตตาล็อกสินค้า_:
1. ลูกค้าเลือกสินค้าชิ้นหนึ่ง เช่น _เสื้อเชิ้ต_  
2. โมเดลจะ _แนะนำสินค้าอื่น_ ทันทีตามสิ่งที่ลูกค้าเลือก  เว็บไซต์จะแสดงคำแนะนำจากโมเดลแบบทันที

ลูกค้าสามารถเลือกสินค้าในร้านค้าออนไลน์ได้ทุกเมื่อ คุณจึงต้องการให้โมเดล _แนะนำสินค้า_ ได้ _แทบจะทันที_ เวลาที่ใช้ในการโหลดหน้าเว็บและแสดงรายละเอียดเสื้อเชิ้ต ควรเท่ากับเวลาที่ใช้ในการ _ประมวลผลคำแนะนำ_ จากโมเดล เมื่อเสื้อเชิ้ตปรากฏบนหน้าเว็บ _คำแนะนำจากโมเดล_ ก็ควรแสดงพร้อมกันด้วย
### Get batch predictions

ถ้าคุณต้องการให้โมเดลประมวลผลข้อมูลใหม่แบบ _เป็นชุด_ และบันทึกผลลัพธ์ลงในไฟล์หรือฐานข้อมูล คุณจะต้องใช้ _การพยากรณ์แบบเป็นชุด (batch prediction)_

ตัวอย่างเช่น คุณฝึกโมเดลเพื่อ _พยากรณ์ยอดขายน้ำส้ม_ สำหรับแต่ละสัปดาห์ล่วงหน้า  
การพยากรณ์นี้จะช่วยให้คุณสามารถ _เตรียมสินค้าให้เพียงพอ_ ต่อความต้องการที่คาดการณ์ไว้

ลองจินตนาการว่าคุณกำลัง _แสดงรายงานยอดขายในอดีต_ คุณจะต้องการแสดง _ยอดขายที่คาดการณ์ไว้_ ในรายงานเดียวกันด้วย

แม้ว่าน้ำส้มจะถูกขายตลอดทั้งวัน แต่คุณต้องการให้โมเดล _พยากรณ์เพียงสัปดาห์ละครั้ง_ คุณสามารถ _เก็บข้อมูลยอดขายทั้งสัปดาห์_ แล้วค่อยเรียกใช้งานโมเดลเมื่อมีข้อมูลครบทั้งสัปดาห์ การรวบรวมข้อมูลหลายรายการในครั้งเดียว เรียกว่า _batch_

## Decide between real-time or batch deployment

เพื่อจะตัดสินใจว่าโมเดลควรถูกออกแบบให้ _ใช้งานแบบเรียลไทม์_ หรือ _แบบเป็นชุด (batch)_ คุณควรพิจารณาคำถามเหล่านี้:

- ต้องการให้โมเดลพยากรณ์บ่อยแค่ไหน?  
- ต้องใช้ผลลัพธ์ภายในเวลากี่วินาทีหรือกี่นาที?  
- ต้องการให้โมเดลพยากรณ์แบบทีละรายการหรือแบบชุด?  
- ต้องใช้ทรัพยากรคอมพิวต์มากแค่ไหนในการรันโมเดล?

### Identify the necessary frequency of scoring

ในสถานการณ์ทั่วไป เรามักใช้โมเดลเพื่อ _ประมวลผลข้อมูลใหม่ (score new data)_  
ก่อนจะได้ผลลัพธ์แบบ _เรียลไทม์_ หรือ _แบบเป็นชุด (batch)_ เราต้อง _รวบรวมข้อมูลใหม่_ ให้ได้ก่อน

มีหลายวิธีในการสร้างหรือรวบรวมข้อมูล ซึ่งอาจเกิดขึ้นในช่วงเวลาแตกต่างกัน

ตัวอย่างเช่น  
- รวบรวมข้อมูลอุณหภูมิจาก _อุปกรณ์ IoT_ ทุก ๆ นาที  
- รับข้อมูลธุรกรรมทุกครั้งที่ลูกค้าซื้อสินค้าในเว็บไซต์  
- ดึงข้อมูลทางการเงินจากฐานข้อมูลทุก ๆ 3 เดือน

โดยทั่วไปมี _สองประเภทของการใช้งาน_:

1. ต้องการให้โมเดล _ประมวลผลข้อมูลทันที_ เมื่อข้อมูลเข้ามา  
2. สามารถ _ตั้งเวลา_ หรือ _ตั้งเงื่อนไข_ เพื่อให้โมเดลประมวลผลข้อมูลที่รวบรวมไว้ได้ในภายหลัง

การจะเลือกใช้ _การพยากรณ์แบบเรียลไทม์_ หรือ _แบบเป็นชุด (batch)_ ไม่ได้ขึ้นอยู่กับว่า _ข้อมูลใหม่ถูกเก็บบ่อยแค่ไหน_  
แต่ขึ้นอยู่กับว่า _ต้องการผลลัพธ์บ่อยแค่ไหน_ และ _ต้องการเร็วแค่ไหน_

ถ้าคุณต้องการให้โมเดล _พยากรณ์ทันที_ เมื่อมีข้อมูลใหม่ แสดงว่าคุณต้องใช้ _การพยากรณ์แบบเรียลไทม์_ แต่ถ้าคุณใช้ผลลัพธ์จากโมเดล _แค่ในบางช่วงเวลา_ เท่านั้น ก็ใช้ _การพยากรณ์แบบเป็นชุด (batch prediction)_ จะเหมาะสมกว่า

### Decide on the number of predictions

อีกคำถามสำคัญที่ควรถามตัวเองคือ เราต้องการให้โมเดล _ทำนายทีละรายการ (individually)_ หรือ _ทำนายแบบกลุ่ม (batch)_?

วิธีที่เข้าใจง่ายในการอธิบายความแตกต่างระหว่าง _individual_ และ _batch predictions_ คือการนึกภาพว่าเรามีตารางข้อมูลลูกค้า โดยแต่ละแถวในตารางแทนลูกค้าแต่ละคน ซึ่งเรามีข้อมูลประชากรและพฤติกรรม เช่น จำนวนสินค้าที่ลูกค้าซื้อ และวันที่ซื้อครั้งล่าสุด

จากข้อมูลนี้ เราสามารถใช้โมเดลพยากรณ์ _churn_ ได้ว่า ลูกค้าจะกลับมาซื้อของอีกหรือไม่

เมื่อเราเทรนโมเดลเสร็จแล้ว เราสามารถเลือกได้ว่าจะให้โมเดล _ทำนายแบบใด_:

_แบบทีละรายการ (Individually)_ คือ โมเดลรับข้อมูลลูกค้าเพียง 1 แถว แล้วทำนายว่าลูกค้าคนนั้นจะซื้ออีกหรือไม่

_แบบกลุ่ม (Batch)_ คือ โมเดลรับข้อมูลลูกค้าหลายแถวในครั้งเดียว แล้วคืนผลลัพธ์ว่าลูกค้าแต่ละคนจะซื้ออีกหรือไม่ โดยผลลัพธ์จะถูกรวมไว้ในตารางเดียวกัน

นอกจากนี้ เรายังสามารถเลือก _แบบทีละรายการ_ หรือ _แบบกลุ่ม_ ได้แม้กระทั่งตอนที่ทำงานกับ _ไฟล์_ เช่น ถ้าใช้โมเดล _computer vision_ อาจจะต้องให้โมเดลวิเคราะห์ภาพทีละรูป หรือหลายรูปพร้อมกันในหนึ่งชุด

### Consider the cost of compute

นอกจากการใช้ _compute_ ตอนฝึกโมเดลแล้ว เรายังต้องใช้ _compute_ ตอนนำโมเดลไปใช้งาน (_deployment_) ด้วย โดยขึ้นอยู่กับว่าเราจะเลือกใช้แบบ _real-time_ หรือ _batch endpoint_ ซึ่งแต่ละแบบจะใช้ _compute_ ที่ต่างกัน และมีค่าใช้จ่ายที่ต่างกันด้วย

ถ้าต้องการ _real-time predictions_ หมายถึงต้องการให้ระบบตอบกลับผลลัพธ์ทันทีเมื่อมีข้อมูลเข้า ระบบต้องมี _compute_ ที่พร้อมทำงานตลอดเวลา เช่น _Azure Container Instance (ACI)_ หรือ _Azure Kubernetes Service (AKS)_ ซึ่งเหมาะกับงานที่ต้องให้โมเดลตอบสนองอย่างรวดเร็ว

แต่เมื่อเลือกใช้ _container technology_ แบบนี้ ตัว _compute_ จะ _เปิดตลอด_ ไม่สามารถหยุดได้ เพราะโมเดลต้องพร้อมใช้งานอยู่เสมอ นั่นหมายถึงคุณจะต้องจ่ายเงินค่าคอมพิวต์ตลอดเวลา ไม่ว่าจะมีการเรียกใช้งานหรือไม่ก็ตาม

ในทางกลับกัน ถ้าคุณต้องการ _batch predictions_ ซึ่งมักใช้กับงานที่มีข้อมูลจำนวนมากและสามารถรอผลลัพธ์ได้ คุณจะใช้ _compute cluster_ ที่สามารถประมวลผลข้อมูลแบบ _ขนาน (parallel batches)_ โดยใช้ _หลาย node_ ทำงานพร้อมกัน

ข้อดีของ _batch endpoint_ คือระบบจะ _สร้าง compute ขึ้นมาเฉพาะตอนที่มีงาน_ และ _ปิดการทำงาน (scale down to 0 nodes)_ อัตโนมัติเมื่อไม่มีข้อมูลใหม่ ทำให้คุณประหยัดค่าใช้จ่ายได้มาก เพราะไม่ต้องจ่ายตอนที่ระบบไม่ได้ทำงาน

